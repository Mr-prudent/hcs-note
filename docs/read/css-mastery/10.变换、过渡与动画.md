# **第10章 变换、过渡与动画**

元素的变换不会影响页面布局，过渡是一种简化的动画。

## **10.1 概述**

css变化用于在空间中移动物体，css过渡和关键帧动画用于控制元素随时间移动的变化

## 10.2 二位变换

给元素应用变换，会为元素最初所在的空间创建所谓的局部坐标系统，用于转换元素的像素。

旋转后的元素不会妨碍其他部分的布局

### 10.2.1 变换原点

默认情况下变换以元素边框盒子的中心作为原点。`transform-origin`可以控制原点的位置。

可以给`transform-origin`设置1-3个值，代表x, y, z轴坐标。如果只给了一个值，第二个默认是center，第三个值不影响二维变换。

```css
.box {
  transform-origin: 10px 10px;
  transform: rotate(45deg);
}
```

> 给SVG元素应用变换，默认原点为左上角 

### 10.2.2 平移

平移就是移动到新位置。可以沿x, y轴平移，也可以沿两个轴。

使用`translate()`函数时，要传入2个坐标值。可以传长度值、像素、em或者百分比。百分比是相对自身大小，而不是父元素。

```css
.box {
  transform: translate(100%, 0); // 向右移动自身100%宽度
}
```

### 10.2.3 多重变换

 可以同时应用多重变换。以空格的列表形式传给`transform`属性，将按照顺序依次变换。因此，变换的顺序很重要。

> 修改变换：
>
> 声明多个变换后，想增加变换不能直接声明替换，而是要声明中包含之前的整套变换。

### 10.2.4 缩放和变形

`scale()`和`skew()`，都有x, 轴的设置项和变体。

`scale()`函数的参数是没有单位的数值，如果只传一个，就是在x, y轴同时缩放。

```css
.doubled {
  transform: scale(2);
}
```

---

变形是指水平或垂直方向平行的边发生相对位移，或偏移一定角度。

### 10.2.5 二位矩阵变换

对于浏览器而言，所有的变换都归于一个数学结构：变换矩阵。可以通过`matrix()`直接操纵。

### 10.2.6 变换与性能

浏览器在计算CSS效果时，在某些情况下多花一些时间。修改文本大小时，生成的行盒子会随着文本折行而变化，高度变化导致浏览器重新计算布局。

在使用CSS变化时，不会改变元素内部布局，又不会影响外部其他元素，性能很好。

## 10.3 过渡

过渡是一种动画，可以从一种状态过渡到另一种状态。过渡会自动双向运行。

设置过渡属性：

```css
button {
  transform-property: all;
  transform-duration: .15s;
}
```

可以写在一起：

```css
button {
  transform: box-shadow .15s, transform .15s;
}
```

> 必须对两个过渡指定持续时间。

### 10.3.1 过渡计时函数

默认情况下过渡的速度从慢到快再到慢，由`transform-timing-function`属性指定

有一些关键字可以代表不同的缓动函数`linear`, `ease-in`, `ease-out`, `ease-in-out`。

```css
button {
  transition: all .25s ease-in;
}
```

1. 三次贝塞尔曲线函数和“弹性”过渡

   在底层，控制速度变化的数学函数基于三次贝塞尔函数生成。可以借助工具生成。

2. 步进函数

   可以指定过渡中每一步的状态，适合创建定格动画。

### 10.3.4 延迟过渡

可以通过`transition-delay`属性推迟过渡发生。

```css
.hello {
  transition-delay: 1s;
}
```

### 10.3.5 过渡的能否

并非所有CSS属性都可以拿来过渡动画。一般涉及颜色和长度都是可以的，比如`red => blue`，`100px =>200px`。但`display`从`none`到`block`没有中间状态就不行。

1. 可插值

2. 过渡到内容高度

   `height`只能在数值之间过渡，像`auto`这样的关键字不能用于过渡。可以使用`max-height:0`过度到`max-height:100px`实现不定高度的过渡

## 10.4 CSS关键帧动画

CSS过渡是一种**隐式**动画，只能指定两个状态。想要多个状态可以通过定义**关键帧**实现这一类过渡。

### 10.4.1 动画与生命的幻象

可以通过CSS动画吸引注意力，提醒用户解释刚刚发生了什么。

```css
@keyframes roll {
  from {
    transform: translateX(-100%);
    animation-timing-function: ease-in-out;
  }
  20% {
    transform: translateX(-100%) skewX(15deg);
  }
  28% {
    transform: translateX(-100%) skewX(0);
    animation-timing-function: ease-out;
  }
  45% {
    transform: translateX(-100%) skewX(-5deg) rotate(20deg) scaleY(1.1);
    animation-timing-function: ease-in-out;
  }
  50% {
    transform: translateX(-100%) rotate(45deg) scaleY(1.1);
    animation-timing-function: ease-in;
  }
  60% {
    transform: translateX(-100%) rotate(90deg);
  }
  65% {
    transform: translateX(-100%) rotate(90deg) skewY(10deg);
  }
  70% {
    transform: translateX(-100%) rotate(90deg) skewY(0);
  }
  to {
    transform: translateX(-100%) rotate(90deg);
  }
}

.box-inner {
  display: inline-block;
  width: 0.74em;
  height: 0.74em;
  background-color: #fff;
  /* 指定动画序列 */
  animation-name: roll;

  /* 滑动时长 */
  animation-duration: 1.5s;

  /* 动画延迟1s */
  animation-delay: 1s;

  /* 翻滚三次 */
  animation-iteration-count: 3;

  /* 设置计时函数 会被关键帧里的覆盖 */
  animation-timing-function: linear;

  /* 基于右下角翻转 */
  transform-origin: bottom right;
}
```

### 10.4.2 曲线动画

> 注意事项：
>
> 1. 关键中的属性不允许添加!important，会被忽略
> 2. 最好等页面加载完，再通过js触发



## 10.5 三维变换

三维变换中需要多考虑一个维度，可以控制坐标、旋转、变形、缩放元素等。

### 10.5.1 透视

不设置透视距离时，默认为无穷大，因此在y轴上旋转时不会有明显变化。

```css
body {
  perspecti
}
```

1. 透视远点

   默认情况下，为元素的中心点。可以通过`perspective-origin`属性来修改消失点的位置（设置在父元素上）。

2. `perspective()`函数

   可以直接使用`perspective()`设置个别元素的透视原点，不用在父元素上设置















